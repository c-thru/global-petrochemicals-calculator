<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Petrochemicals Calculator model documentation - 3&nbsp; Model logic</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./lever/fertiliser_demand.html" rel="next">
<link href="./system-definitions.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./model-logic.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model logic</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Petrochemicals Calculator model documentation</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./system-definitions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">System definitions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model-logic.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model logic</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Fertilisers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/fertiliser_demand.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">fertiliser_demand</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/fertiliser_production.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">fertiliser_production</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/fertiliser_use_phase.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">fertiliser_use_phase</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Demand model levers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/product_demand.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">product_demand</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/recycling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">recycling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/final_treatment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">final_treatment</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/extra_demand.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">extra_demand</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Petrochemical production levers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/ethylene_methanol_capacity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">ethylene_methanol_capacity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/xylenes_methyl_alcohol_capacity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">xylenes_methyl_alcohol_capacity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/bioethanol_capacity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">bioethanol_capacity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/biosyngas_capacity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">biosyngas_capacity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/frac_of_biomass_feedstock.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">frac_of_biomass_feedstock</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/olefins_paraffins_mix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">olefins_paraffins_mix</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Hydrogen levers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/green_hydrogen_capacity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">green_hydrogen_capacity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/blue_hydrogen_capacity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">blue_hydrogen_capacity</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Abatement levers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/ccs_incineration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">ccs_incineration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/ccs_process_emissions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">ccs_process_emissions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/ccs_utility_combustion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">ccs_utility_combustion</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Utilities &amp; emissions data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/electricity_requirements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">electricity_requirements</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/natural_gas_requirements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">natural_gas_requirements</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/electricity_emission_factor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">electricity_emission_factor</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/natural_gas_emission_factor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">natural_gas_emission_factor</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/direct_process_emissions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">direct_process_emissions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/feedstock_emission_factor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">feedstock_emission_factor</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lever/final_treatment_emission_factor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">final_treatment_emission_factor</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-model-logic-mass" id="toc-sec-model-logic-mass" class="nav-link active" data-scroll-target="#sec-model-logic-mass"><span class="header-section-number">3.1</span> Mass-flow process model</a></li>
  <li><a href="#sec-model-logic-utility-requirements" id="toc-sec-model-logic-utility-requirements" class="nav-link" data-scroll-target="#sec-model-logic-utility-requirements"><span class="header-section-number">3.2</span> Utility requirements</a></li>
  <li><a href="#sec-model-logic-emissions" id="toc-sec-model-logic-emissions" class="nav-link" data-scroll-target="#sec-model-logic-emissions"><span class="header-section-number">3.3</span> Emissions calculation</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-model-logic" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model logic</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>The model first calculates the operation of each process based on balancing mass flows (<a href="#sec-model-logic-mass" class="quarto-xref"><span>Section 3.1</span></a>). From this, utility requirements (<a href="#sec-model-logic-utility-requirements" class="quarto-xref"><span>Section 3.2</span></a>) are calculated, and hence emissions and other metrics are calculated (<a href="#sec-model-logic-emissions" class="quarto-xref"><span>Section 3.3</span></a>).</p>
<section id="sec-model-logic-mass" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sec-model-logic-mass"><span class="header-section-number">3.1</span> Mass-flow process model</h2>
<div id="fig-logic-steps" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-logic-steps-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="model-structure.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-logic-steps-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.1: Model structure and logic steps
</figcaption>
</figure>
</div>
<p>The processes described in <a href="system-definitions.html" class="quarto-xref"><span>Chapter 2</span></a> need to be deployed in suitable combinations to meet demand within the available supply and/or capacity constraints. Generally, there are multiple ways that this could plausibly happen, especially when there are multiple technologies available to produce the same chemical. The model “logic” sets out the mass-flow solutions corresponding to particular choices of model parameters (such as capacities or feedstock shares). This builds up the final pattern of process operation and mass flows step by step, as illustrated in <a href="#fig-logic-steps" class="quarto-xref">Figure&nbsp;<span>3.1</span></a> and described below:</p>
<ol type="1">
<li><p>Determine demand and end-of-life flows of polymers from the stock model (see <a href="lever/product_demand.html" class="quarto-xref"><span>Chapter 7</span></a>).</p></li>
<li><p>Allocate end-of-life polymers to mechanical recycling or chemical recycling based on the recycling rate parameters, with the residual allocated to final treatment options (see <a href="lever/recycling.html" class="quarto-xref"><span>Chapter 8</span></a>, <a href="lever/final_treatment.html" class="quarto-xref"><span>Chapter 9</span></a>).</p></li>
<li><p>Determine required primary chemicals to satisfy the remaining demand for polymers that is not already covered by mechanical recycling. Mechanical recycling is assumed to perfectly substitute virgin polymer production.</p></li>
<li><p>Add in additional demand for primary chemicals to non-polymer applications (see <a href="lever/extra_demand.html" class="quarto-xref"><span>Chapter 10</span></a>).</p></li>
<li><p>Produce primary chemicals in turn using preferred routes first, until their capacity has been exhausted. First, ethylene demand is satisfied:</p>
<ul>
<li>Ethylene is produced from biomass via ethyl alcohol, where capacity is available (see <a href="lever/bioethanol_capacity.html" class="quarto-xref"><span>Chapter 13</span></a>).</li>
<li>Ethylene is produced from methyl alcohol (methanol), where MTO capacity is available (see <a href="lever/ethylene_methanol_capacity.html" class="quarto-xref"><span>Chapter 11</span></a>).</li>
<li>Any residual demand for ethylene is produced from steam cracking of fossil naphtha and ethane (see <a href="lever/olefins_paraffins_mix.html" class="quarto-xref"><span>Chapter 16</span></a>).</li>
</ul>
<p>These processes produce benzene, toluene, and xylenes (BTX) as by-products; if further demand for BTX remains, then it is satisfied as follows:</p>
<ul>
<li>Demand for xylenes is satisfied from methyl alcohol, where MTA capacity is available (see <a href="lever/xylenes_methyl_alcohol_capacity.html" class="quarto-xref"><span>Chapter 12</span></a>).</li>
<li>Excess toluene production is converted to xylenes by disproportionation.</li>
<li>Remaining demand for BTX is produced via catalytic reforming of naphtha, with dealkylation and disproportionation used to balance the mix of BTX as far as possible.</li>
</ul>
<p>Finally, on-purpose production of propylene and butadiene is deployed if insufficient supply has already been produced as by-products above:</p>
<ul>
<li>Propylene is produced from methanol (MTP) is additional capacity is still available (see <a href="lever/ethylene_methanol_capacity.html" class="quarto-xref"><span>Chapter 11</span></a>), falling back on dehydrogenation of propane.</li>
<li>Butadiene is produced from distillation of excess butylenes supply as co-product of previous processes, if available, falling back on dehydrogenation of butane.</li>
</ul></li>
<li><p>Now upstream production is determined, starting with supply of methyl alcohol:</p>
<ul>
<li>Methyl alcohol is produced from green hydrogen when capacity is available (see <a href="lever/green_hydrogen_capacity.html" class="quarto-xref"><span>Chapter 17</span></a>).</li>
<li>Any remaining demand for methyl alcohol is produced from syngas, as below.</li>
</ul>
<p>Syngas is produced from biomass or fossil feedstocks:</p>
<ul>
<li>Syngas is produced from gasification of crop residues where capacity is available (see <a href="lever/biosyngas_capacity.html" class="quarto-xref"><span>Chapter 14</span></a>).</li>
<li>Any remaining demand for syngas is produced from natural gas and coal.</li>
</ul>
<p>Remaining demand for hydrogen is produced via green (<a href="lever/green_hydrogen_capacity.html" class="quarto-xref"><span>Chapter 17</span></a>), blue (<a href="lever/green_hydrogen_capacity.html" class="quarto-xref"><span>Chapter 17</span></a>), and grey routes in order of preference, up to capacity limits.</p>
<p>Fossil paraffins are sourced from oil refining.</p></li>
<li><p>Separately, fertiliser use is determined according to the scenarios of <span class="citation" data-cites="gao_greenhouse_2023">Gao and Cabrera Serrenho (<a href="references.html#ref-gao_greenhouse_2023" role="doc-biblioref">2023</a>)</span> (see <a href="lever/fertiliser_demand.html" class="quarto-xref"><span>Chapter 4</span></a>, <a href="lever/fertiliser_production.html" class="quarto-xref"><span>Chapter 5</span></a>, <a href="lever/fertiliser_use_phase.html" class="quarto-xref"><span>Chapter 6</span></a>).</p></li>
</ol>
<p>Overall, this model logic ensures that any setting of the demand and production capacity parameters results in a pattern of process deployment that is mass balanced and broadly technically plausible, considering the mix of process co-products and routes, even when demand patterns change dramatically and assumptions about allocation factors of chemicals to applications are no longer valid.</p>
</section>
<section id="sec-model-logic-utility-requirements" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="sec-model-logic-utility-requirements"><span class="header-section-number">3.2</span> Utility requirements</h2>
<p>Utility requirements (natural gas and electricity) are calculated for each process by multiplying the process operation, calculated from the mass flow logic above, with utility requirement parameters (see <a href="lever/electricity_requirements.html" class="quarto-xref"><span>Chapter 22</span></a>, <a href="lever/natural_gas_requirements.html" class="quarto-xref"><span>Chapter 23</span></a>).</p>
</section>
<section id="sec-model-logic-emissions" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="sec-model-logic-emissions"><span class="header-section-number">3.3</span> Emissions calculation</h2>
<p>Emissions from electricity use are based on the parameter <code>EF_Utility_Electricity</code> (see <a href="lever/electricity_emission_factor.html" class="quarto-xref"><span>Chapter 24</span></a>), with one exception: electricity used for green hydrogen production is assumed to be always supplied by low-carbon electricity at an emissions factor of 7 gCO<sub>2e</sub>/kWh <span class="citation" data-cites="meys_achieving_2021">(<a href="references.html#ref-meys_achieving_2021" role="doc-biblioref">Meys et al. 2021</a>)</span>.</p>
<p>Emissions from natural gas use are based on the parameter <code>EF_Utility_NaturalGas</code> (see <a href="lever/natural_gas_emission_factor.html" class="quarto-xref"><span>Chapter 25</span></a>), reduced by a combustion emissions abatement factor (see <a href="lever/ccs_utility_combustion.html" class="quarto-xref"><span>Chapter 21</span></a>).</p>
<p>Emissions from process reactions are based on emissions factors for CO<sub>2</sub>, CH<sub>4</sub> and N<sub>2</sub>O (see <a href="lever/direct_process_emissions.html" class="quarto-xref"><span>Chapter 26</span></a>, <a href="lever/final_treatment_emission_factor.html" class="quarto-xref"><span>Chapter 28</span></a>), converted to GWP using IPCC AR5 factors of 1, 28 and 265 respectively. Emissions are reduced by a direct process emissions abatement factor (see <a href="lever/ccs_process_emissions.html" class="quarto-xref"><span>Chapter 20</span></a>), with two exceptions: end-of-life incineration emissions abatement is controlled by a separate lever (<a href="lever/ccs_incineration.html" class="quarto-xref"><span>Chapter 19</span></a>), and emissions from end-of-life ‘mismanagement’ are never abated.</p>
<p>The total quantity of emissions abatement capacity that has been used is accumulated and reported as an additional model output.</p>
<p>Upstream emissions associated with feedstock production are calculated using emissions factors (see <a href="lever/feedstock_emission_factor.html" class="quarto-xref"><span>Chapter 27</span></a>).</p>
<p>Finally, processes are grouped according to <a href="#tbl-process-groups" class="quarto-xref">Table&nbsp;<span>3.1</span></a> for reporting emissions totals.</p>
<div class="cell" data-execution_count="2">
<div id="tbl-process-groups" class="cell quarto-float anchored" data-execution_count="2">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-process-groups-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.1: Process groups for emissions reporting.
</figcaption>
<div aria-describedby="tbl-process-groups-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="10">
<table class="do-not-create-environment cell table table-sm table-striped small">
<colgroup>
<col style="width: 23%">
<col style="width: 76%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Group</th>
<th style="text-align: left;">Process</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">biomass</td>
<td style="text-align: left;">CornStoverGasificationToSyngas</td>
</tr>
<tr class="even">
<td style="text-align: left;">biomass</td>
<td style="text-align: left;">EthylAlcoholSynthesisFromCornStover</td>
</tr>
<tr class="odd">
<td style="text-align: left;">biomass</td>
<td style="text-align: left;">EthylAlcoholSynthesisFromMaize</td>
</tr>
<tr class="even">
<td style="text-align: left;">biomass</td>
<td style="text-align: left;">EthylAlcoholSynthesisFromRiceStraw</td>
</tr>
<tr class="odd">
<td style="text-align: left;">biomass</td>
<td style="text-align: left;">EthylAlcoholSynthesisFromSugarcane</td>
</tr>
<tr class="even">
<td style="text-align: left;">biomass</td>
<td style="text-align: left;">EthylAlcoholSynthesisFromSugarcaneBagasse</td>
</tr>
<tr class="odd">
<td style="text-align: left;">biomass</td>
<td style="text-align: left;">EthylAlcoholSynthesisFromWheatStraw</td>
</tr>
<tr class="even">
<td style="text-align: left;">biomass</td>
<td style="text-align: left;">RiceStrawGasificationToSyngas</td>
</tr>
<tr class="odd">
<td style="text-align: left;">biomass</td>
<td style="text-align: left;">SugarCaneBagasseGasificationToSyngas</td>
</tr>
<tr class="even">
<td style="text-align: left;">biomass</td>
<td style="text-align: left;">WheatStrawGasificationToSyngas</td>
</tr>
<tr class="odd">
<td style="text-align: left;">downstream</td>
<td style="text-align: left;">PolymerisationOfFibrePPA</td>
</tr>
<tr class="even">
<td style="text-align: left;">downstream</td>
<td style="text-align: left;">PolymerisationOfHDPE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">downstream</td>
<td style="text-align: left;">PolymerisationOfLDPE</td>
</tr>
<tr class="even">
<td style="text-align: left;">downstream</td>
<td style="text-align: left;">PolymerisationOfLLDPE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">downstream</td>
<td style="text-align: left;">PolymerisationOfOtherPolymers</td>
</tr>
<tr class="even">
<td style="text-align: left;">downstream</td>
<td style="text-align: left;">PolymerisationOfPET</td>
</tr>
<tr class="odd">
<td style="text-align: left;">downstream</td>
<td style="text-align: left;">PolymerisationOfPP</td>
</tr>
<tr class="even">
<td style="text-align: left;">downstream</td>
<td style="text-align: left;">PolymerisationOfPUR</td>
</tr>
<tr class="odd">
<td style="text-align: left;">downstream</td>
<td style="text-align: left;">PolymerisationOfPVC</td>
</tr>
<tr class="even">
<td style="text-align: left;">downstream</td>
<td style="text-align: left;">PolymerisationOfPolystyrene</td>
</tr>
<tr class="odd">
<td style="text-align: left;">downstream</td>
<td style="text-align: left;">PolymerisationOfStyreneButadiene</td>
</tr>
<tr class="even">
<td style="text-align: left;">end_of_life</td>
<td style="text-align: left;">ChemicalRecyclingOfMixedPolymersAtEOL</td>
</tr>
<tr class="odd">
<td style="text-align: left;">end_of_life</td>
<td style="text-align: left;">Incineration</td>
</tr>
<tr class="even">
<td style="text-align: left;">end_of_life</td>
<td style="text-align: left;">Landfilling</td>
</tr>
<tr class="odd">
<td style="text-align: left;">end_of_life</td>
<td style="text-align: left;">MechanicalRecyclingOfFibrePPAAtEOL</td>
</tr>
<tr class="even">
<td style="text-align: left;">end_of_life</td>
<td style="text-align: left;">MechanicalRecyclingOfHDPEPolyethyleneAtEOL</td>
</tr>
<tr class="odd">
<td style="text-align: left;">end_of_life</td>
<td style="text-align: left;">MechanicalRecyclingOfLDPEPolyethyleneAtEOL</td>
</tr>
<tr class="even">
<td style="text-align: left;">end_of_life</td>
<td style="text-align: left;">MechanicalRecyclingOfLLDPEAtEOL</td>
</tr>
<tr class="odd">
<td style="text-align: left;">end_of_life</td>
<td style="text-align: left;">MechanicalRecyclingOfPETPolyethyleneTerephthalatePolyestersAtEOL</td>
</tr>
<tr class="even">
<td style="text-align: left;">end_of_life</td>
<td style="text-align: left;">MechanicalRecyclingOfPPPolypropyleneAtEOL</td>
</tr>
<tr class="odd">
<td style="text-align: left;">end_of_life</td>
<td style="text-align: left;">MechanicalRecyclingOfPSPolystyreneAtEOL</td>
</tr>
<tr class="even">
<td style="text-align: left;">end_of_life</td>
<td style="text-align: left;">MechanicalRecyclingOfPVCPolyvinylChlorideAtEOL</td>
</tr>
<tr class="odd">
<td style="text-align: left;">end_of_life</td>
<td style="text-align: left;">Mismanagement</td>
</tr>
<tr class="even">
<td style="text-align: left;">green_hydrogen</td>
<td style="text-align: left;">WaterElectrolysisForHydrogen</td>
</tr>
<tr class="odd">
<td style="text-align: left;">organic_synthesis</td>
<td style="text-align: left;">AceticAcidSynthesis</td>
</tr>
<tr class="even">
<td style="text-align: left;">organic_synthesis</td>
<td style="text-align: left;">AcrylonitrileSynthesis</td>
</tr>
<tr class="odd">
<td style="text-align: left;">organic_synthesis</td>
<td style="text-align: left;">AdipicAcidSynthesis</td>
</tr>
<tr class="even">
<td style="text-align: left;">organic_synthesis</td>
<td style="text-align: left;">CyclohexaneSynthesis</td>
</tr>
<tr class="odd">
<td style="text-align: left;">organic_synthesis</td>
<td style="text-align: left;">EthyleneGlycolSynthesis</td>
</tr>
<tr class="even">
<td style="text-align: left;">organic_synthesis</td>
<td style="text-align: left;">EthyleneOxideSynthesis</td>
</tr>
<tr class="odd">
<td style="text-align: left;">organic_synthesis</td>
<td style="text-align: left;">HexamethylenediamineSynthesisFromButadiene</td>
</tr>
<tr class="even">
<td style="text-align: left;">organic_synthesis</td>
<td style="text-align: left;">HydrogenCyanideSynthesis</td>
</tr>
<tr class="odd">
<td style="text-align: left;">organic_synthesis</td>
<td style="text-align: left;">IsophthalicAcidSynthesis</td>
</tr>
<tr class="even">
<td style="text-align: left;">organic_synthesis</td>
<td style="text-align: left;">OtherOrganicChemicalsSynthesis</td>
</tr>
<tr class="odd">
<td style="text-align: left;">organic_synthesis</td>
<td style="text-align: left;">PolyolsSynthesis</td>
</tr>
<tr class="even">
<td style="text-align: left;">organic_synthesis</td>
<td style="text-align: left;">PropyleneOxideSynthesis</td>
</tr>
<tr class="odd">
<td style="text-align: left;">organic_synthesis</td>
<td style="text-align: left;">StyreneSynthesis</td>
</tr>
<tr class="even">
<td style="text-align: left;">organic_synthesis</td>
<td style="text-align: left;">TerephthalicAcidSynthesis</td>
</tr>
<tr class="odd">
<td style="text-align: left;">organic_synthesis</td>
<td style="text-align: left;">TolueneDiisocyanateSynthesis</td>
</tr>
<tr class="even">
<td style="text-align: left;">organic_synthesis</td>
<td style="text-align: left;">VinylChlorideSynthesis</td>
</tr>
<tr class="odd">
<td style="text-align: left;">other_hydrogen</td>
<td style="text-align: left;">NaturalGasSteamMethaneReformingToHydrogen</td>
</tr>
<tr class="even">
<td style="text-align: left;">other_hydrogen</td>
<td style="text-align: left;">NaturalGasSteamMethaneReformingWithCCSToHydrogen</td>
</tr>
<tr class="odd">
<td style="text-align: left;">primary_production</td>
<td style="text-align: left;">CarbonDioxideHydrogenationToMethylAlcohol</td>
</tr>
<tr class="even">
<td style="text-align: left;">primary_production</td>
<td style="text-align: left;">CatalyticReformingOfNaphthaForToluene</td>
</tr>
<tr class="odd">
<td style="text-align: left;">primary_production</td>
<td style="text-align: left;">CatalyticReformingOfNaphthaForXylenes</td>
</tr>
<tr class="even">
<td style="text-align: left;">primary_production</td>
<td style="text-align: left;">CoalGasificationToSyngas</td>
</tr>
<tr class="odd">
<td style="text-align: left;">primary_production</td>
<td style="text-align: left;">DealkylationOfTolueneForBenzene</td>
</tr>
<tr class="even">
<td style="text-align: left;">primary_production</td>
<td style="text-align: left;">DehydrationOfEthylAlcohol</td>
</tr>
<tr class="odd">
<td style="text-align: left;">primary_production</td>
<td style="text-align: left;">DehydrogenationOfButaneForButadiene</td>
</tr>
<tr class="even">
<td style="text-align: left;">primary_production</td>
<td style="text-align: left;">DehydrogenationOfPropane</td>
</tr>
<tr class="odd">
<td style="text-align: left;">primary_production</td>
<td style="text-align: left;">DisproportionationOfTolueneForXylenes</td>
</tr>
<tr class="even">
<td style="text-align: left;">primary_production</td>
<td style="text-align: left;">DistillationOfButylenesForButadiene</td>
</tr>
<tr class="odd">
<td style="text-align: left;">primary_production</td>
<td style="text-align: left;">DistillationOfPyrolysisGasolineForBTX</td>
</tr>
<tr class="even">
<td style="text-align: left;">primary_production</td>
<td style="text-align: left;">FischerTropschSynthesisOfOlefinsFromSyngas</td>
</tr>
<tr class="odd">
<td style="text-align: left;">primary_production</td>
<td style="text-align: left;">FluidCatalyticCrackingOfGasOil</td>
</tr>
<tr class="even">
<td style="text-align: left;">primary_production</td>
<td style="text-align: left;">MethylAlcoholSynthesis</td>
</tr>
<tr class="odd">
<td style="text-align: left;">primary_production</td>
<td style="text-align: left;">MethylAlcoholToAromatics</td>
</tr>
<tr class="even">
<td style="text-align: left;">primary_production</td>
<td style="text-align: left;">MethylAlcoholToOlefins</td>
</tr>
<tr class="odd">
<td style="text-align: left;">primary_production</td>
<td style="text-align: left;">MethylAlcoholToPropylene</td>
</tr>
<tr class="even">
<td style="text-align: left;">primary_production</td>
<td style="text-align: left;">NaturalGasSteamMethaneReformingToSyngas</td>
</tr>
<tr class="odd">
<td style="text-align: left;">primary_production</td>
<td style="text-align: left;">SodiumChlorideElectrolysisForChlorine</td>
</tr>
<tr class="even">
<td style="text-align: left;">primary_production</td>
<td style="text-align: left;">SteamCrackingOfEthane</td>
</tr>
<tr class="odd">
<td style="text-align: left;">primary_production</td>
<td style="text-align: left;">SteamCrackingOfNaphtha</td>
</tr>
<tr class="even">
<td style="text-align: left;">primary_production</td>
<td style="text-align: left;">SyngasToAmmoniaProduction</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Emissions from fertiliser production are calculated directly from the production quantity of each fertiliser type (see <a href="lever/fertiliser_demand.html" class="quarto-xref"><span>Chapter 4</span></a>), and production &amp; use-phase emissions factors (see <a href="lever/fertiliser_production.html" class="quarto-xref"><span>Chapter 5</span></a>, <a href="lever/fertiliser_use_phase.html" class="quarto-xref"><span>Chapter 6</span></a>).</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-gao_greenhouse_2023" class="csl-entry" role="listitem">
Gao, Yunhu, and André Cabrera Serrenho. 2023. <span>“Greenhouse Gas Emissions from Nitrogen Fertilizers Could Be Reduced by up to One-Fifth of Current Levels by 2050 with Combined Interventions.”</span> <em>Nature Food</em> 4 (2): 170–78. <a href="https://doi.org/10.1038/s43016-023-00698-w">https://doi.org/10.1038/s43016-023-00698-w</a>.
</div>
<div id="ref-meys_achieving_2021" class="csl-entry" role="listitem">
Meys, Raoul, Arne Kätelhön, Marvin Bachmann, Benedikt Winter, Christian Zibunas, Sangwon Suh, and André Bardow. 2021. <span>“Achieving Net-Zero Greenhouse Gas Emission Plastics by a Circular Carbon Economy.”</span> Journal Article. <em>Science</em> 374 (6563): 71–76. <a href="https://doi.org/10.1126/science.abg9853">https://doi.org/10.1126/science.abg9853</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./system-definitions.html" class="pagination-link" aria-label="System definitions">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">System definitions</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./lever/fertiliser_demand.html" class="pagination-link" aria-label="fertiliser_demand">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">fertiliser_demand</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>